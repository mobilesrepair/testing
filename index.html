<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CheckPhone Panel</title>

<style>
body{
font-family:Segoe UI;
background:#0f172a;
color:white;
text-align:center;
margin:0;
}

.box{
background:#111827;
max-width:420px;
margin:40px auto;
padding:25px;
border-radius:12px;
box-shadow:0 0 20px rgba(0,0,0,.4);
}

input,select,button{
width:100%;
padding:12px;
margin-top:10px;
border-radius:8px;
border:none;
}

input,select{
background:#1f2937;
color:white;
}

button{
background:#22c55e;
color:white;
font-weight:bold;
cursor:pointer;
}

button:hover{
background:#16a34a;
}

.result{
margin-top:15px;
background:#020617;
padding:12px;
border-radius:8px;
text-align:left;
white-space:pre-wrap;
}

.hidden{display:none}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox" class="box">
<h2>CheckPhone Panel</h2>

<input id="email" placeholder="Enter Email">

<button onclick="login()">Login / Register</button>

</div>


<!-- DASHBOARD -->
<div id="dashBox" class="box hidden">

<h3 id="wallet">Balance: RM 0</h3>

<select id="service"></select>

<input id="imei" placeholder="Enter IMEI">

<button onclick="checkIMEI()">CHECK</button>

<div id="result" class="result"></div>

<button onclick="logout()">Logout</button>

</div>


<script>

const API="https://YOUR-WORKER.workers.dev";

let SESSION="";
let EMAIL="";

/* ================= LOGIN ================= */

async function login(){

EMAIL=email.value;

await fetch(API+"/register",{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({email:EMAIL})
});

const res=await fetch(API+"/login",{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({email:EMAIL})
});

const data=await res.json();

SESSION=data.session;

localStorage.session=SESSION;
localStorage.email=EMAIL;

loadDashboard();
}

/* ================= DASHBOARD ================= */

async function loadDashboard(){

loginBox.classList.add("hidden");
dashBox.classList.remove("hidden");

SESSION=localStorage.session;
EMAIL=localStorage.email;

/* wallet */
const user=await fetch(API+"/dashboard",{
headers:{session:SESSION}
}).then(r=>r.json());

wallet.innerText="Balance: RM "+user.credit;

/* load services */
const services=await fetch(API+"/services")
.then(r=>r.json());

let html="";

services.forEach(s=>{
html+=`<option value="${s.id}">
${s.name}
</option>`;
});

service.innerHTML=html;
}

/* ================= CHECK ================= */

async function checkIMEI(){

result.innerText="Checking...";

const res=await fetch(API+"/check",{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
imei:imei.value,
service:service.value,
email:EMAIL
})
});

const data=await res.json();

result.innerText=JSON.stringify(data,null,2);

loadDashboard();
}

/* ================= LOGOUT ================= */

function logout(){
localStorage.clear();
location.reload();
}

/* AUTO LOGIN */
if(localStorage.session){
loadDashboard();
}

</script>

</body>
</html>
