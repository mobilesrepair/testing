<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Repair Requests</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-6 min-h-screen">

  <h1 class="text-3xl font-bold mb-6">Request a Repair Service</h1>

  <form id="repairForm" class="bg-white p-6 rounded shadow-md max-w-md space-y-4">
    <input name="name" type="text" placeholder="Your Name" required class="w-full p-2 border rounded" /><input name="phoneModel" type="text" placeholder="Phone Model" required class="w-full p-2 border rounded" />
    <input name="imei" type="text" placeholder="IMEI Number" required class="w-full p-2 border rounded" />
    <select name="issueType" required class="w-full p-2 border rounded">
      <option value="" disabled selected>Select Issue Type</option>
      <option value="Network Unlock">Network Unlock</option>
      <option value="Xiaomi Flash">Xiaomi Flash</option>
      <option value="Software Brick Fix">Software Brick Fix</option>
      <option value="Auth Downgrade">Auth Downgrade</option>
      <option value="Other">Other</option>
    </select>
    <input name="whatsapp" type="tel" placeholder="WhatsApp Number" required class="w-full p-2 border rounded" />
    <button type="submit" class="bg-blue-600 text-white py-2 rounded w-full font-semibold hover:bg-blue-700">Submit Request</button>
  </form>

  <h2 class="text-2xl font-semibold mt-10 mb-4">Saved Requests</h2>
  <div id="requestsList" class="max-w-md space-y-3"></div>

<script>
  const scriptURL = 'https://script.google.com/macros/s/AKfycbzCysPc1aczPQ4a4D-uouA0RGfGMFZeyTv6KkgAKiwbBNEvb2q7eP4Aff1JVsHzlcD0/exec';

  const form = document.getElementById('repairForm');
  const requestsList = document.getElementById('requestsList');
  form.addEventListener('submit', async e => {
    e.preventDefault();

    const data = {
      name: form.name.value,
      phoneModel: form.phoneModel.value,
      imei: form.imei.value,
      issueType: form.issueType.value,
      whatsapp: form.whatsapp.value
    };

    try {
      const res = await fetch(scriptURL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      const result = await res.json();
      if (result.result === 'success') {
        alert('Request submitted successfully!');
        form.reset();
        loadRequests();
      } else {
        alert('Failed to submit request.');
      }
    } catch (err) {
      alert('Error submitting form.');
      console.error(err);
    }
  });

  async function loadRequests() {
    try {
      const res = await fetch(scriptURL + '?action=get');
      const data = await res.json();
      requestsList.innerHTML = '';
      if (data.requests && data.requests.length > 0) {
        data.requests.forEach(r => {
          const div = document.createElement('div');
          div.className = 'p-3 border rounded bg-white';
          div.innerHTML = `
            <strong>r.name</strong> ({r.phoneModel})<br/>
            IMEI: ${r.imei}<br/>Issue:{r.issueType}<br/>
            WhatsApp: r.whatsapp<br/>
            <em>{new Date(r.timestamp).toLocaleString()}</em>
          `;
          requestsList.appendChild(div);
        });
      } else {
        requestsList.textContent = 'No requests found.';
      }
    } catch (err) {
      requestsList.textContent = 'Failed to load requests.';
      console.error(err);
    }
  }

  loadRequests();
</script>

</body>
</html>
