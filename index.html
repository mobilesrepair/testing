<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CheckPhone</title>

<style>
body{font-family:Segoe UI;background:#f4f6f9;text-align:center}

.box{
background:white;
max-width:400px;
margin:40px auto;
padding:25px;
border-radius:12px;
box-shadow:0 10px 30px rgba(0,0,0,.1);
}

input,button{
width:100%;
padding:12px;
margin-top:10px;
}

button{
background:#0b57d0;
color:white;
border:none;
border-radius:8px;
cursor:pointer;
}

.hidden{display:none}

.result{
margin-top:15px;
white-space:pre-wrap;
background:#eee;
padding:10px;
border-radius:8px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginPage" class="box">
<h3>Login</h3>
<input id="email" placeholder="Email">
<button onclick="login()">Send OTP</button>

<input id="otp" placeholder="OTP">
<button onclick="verifyLogin()">Login</button>
</div>


<!-- DASHBOARD -->
<div id="dashboardPage" class="box hidden">
<h3>Dashboard</h3>

<div id="userInfo"></div>

<input id="imei" placeholder="IMEI">
<button onclick="checkIMEI()">Check IMEI</button>

<div id="result" class="result"></div>

<button onclick="logout()">Logout</button>
</div>


<script>

const API="https://plain-pond-c616.r3dvelvet92.workers.dev";

// ================= PAGE SWITCH =================
function showDashboard(){
loginPage.classList.add("hidden");
dashboardPage.classList.remove("hidden");
userInfo.innerText="Logged as: "+localStorage.email;
}

function showLogin(){
dashboardPage.classList.add("hidden");
loginPage.classList.remove("hidden");
}

// ================= AUTO LOGIN =================
if(localStorage.getItem("email")){
showDashboard();
}

// ================= LOGIN =================
async function login(){

const res=await fetch(API+"/login",{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({email:email.value})
});

const data=await res.json();
alert("OTP sent to email");
}

// ================= VERIFY =================
async function verifyLogin(){

const res=await fetch(API+"/verify-login",{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
email:email.value,
otp:otp.value
})
});

const data=await res.json();

if(data.success){
localStorage.email=email.value;
showDashboard();
}else{
alert("Login failed");
}
}

// ================= CHECK IMEI =================
async function checkIMEI(){

result.innerText="Checking...";

const res=await fetch(API+"/check-imei",{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
email:localStorage.email,
imei:imei.value
})
});

result.innerText=await res.text();
}

// ================= LOGOUT =================
function logout(){
localStorage.clear();
showLogin();
}

</script>

</body>
</html>
