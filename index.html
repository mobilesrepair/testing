<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CheckPhone Panel</title>

<style>
body{
font-family:Segoe UI;
background:#f4f6f9;
text-align:center;
}

.box{
background:white;
max-width:420px;
margin:40px auto;
padding:25px;
border-radius:12px;
box-shadow:0 10px 30px rgba(0,0,0,.1);
}

input,select,button{
width:100%;
padding:12px;
margin-top:10px;
}

button{
background:#0b57d0;
color:white;
border:none;
border-radius:8px;
cursor:pointer;
}

.hidden{display:none}

.result{
margin-top:15px;
background:#eee;
padding:10px;
border-radius:8px;
white-space:pre-wrap;
text-align:left;
}
</style>
</head>

<body>

<!-- REGISTER -->
<div id="registerPage" class="box">
<h3>Register</h3>

<input id="regEmail" placeholder="Email">
<button onclick="register()">Register</button>

<input id="regOtp" placeholder="OTP">
<button onclick="verifyRegister()">Verify OTP</button>

<hr>
<button onclick="showLogin()">Already have account?</button>
</div>


<!-- LOGIN -->
<div id="loginPage" class="box hidden">
<h3>Login</h3>

<input id="email" placeholder="Email">
<button onclick="login()">Send OTP</button>

<input id="otp" placeholder="OTP">
<button onclick="verifyLogin()">Login</button>

<hr>
<button onclick="showRegister()">Create Account</button>
</div>


<!-- DASHBOARD -->
<div id="dashboardPage" class="box hidden">

<h3>Dashboard</h3>

<div id="wallet"></div>

<select id="service" onchange="loadPrice()">
<option value="12">Basic Info</option>
<option value="105">Apple Sold By</option>
<option value="30">Apple FMI</option>
<option value="41">Samsung Info</option>
</select>

<div id="priceBox"></div>

<input id="imei" placeholder="Enter IMEI">

<button onclick="checkIMEI()">Check IMEI</button>

<div id="result" class="result"></div>

<button onclick="logout()">Logout</button>

</div>


<script>

const API="https://plain-pond-c616.r3dvelvet92.workers.dev";

// ================= PAGE SWITCH =================
function showRegister(){
registerPage.classList.remove("hidden");
loginPage.classList.add("hidden");
}

function showLogin(){
registerPage.classList.add("hidden");
loginPage.classList.remove("hidden");
}

function showDashboard(balance){
loginPage.classList.add("hidden");
registerPage.classList.add("hidden");
dashboardPage.classList.remove("hidden");

wallet.innerText="Balance: RM "+balance;
}

// ================= REGISTER =================
async function register(){

await fetch(API+"/register",{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({email:regEmail.value})
});

alert("OTP sent to email");
}

async function verifyRegister(){

const res=await fetch(API+"/verify-register",{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
email:regEmail.value,
otp:regOtp.value
})
});

const data=await res.json();

if(data.success){
alert("Account verified");
showLogin();
}else{
alert("Invalid OTP");
}
}

// ================= LOGIN =================
async function login(){

await fetch(API+"/login",{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({email:email.value})
});

alert("OTP sent");
}

async function verifyLogin(){

const res=await fetch(API+"/verify-login",{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
email:email.value,
otp:otp.value
})
});

const data=await res.json();

if(data.success){
localStorage.email=email.value;
localStorage.balance=data.balance;
showDashboard(data.balance);
}else{
alert("Login failed");
}
}

// ================= LOAD PRICE =================
async function loadPrice(){

const res=await fetch(API+"/price?service="+service.value);
const data=await res.json();

priceBox.innerText="Price: RM "+data.price;
}

// ================= CHECK IMEI =================
async function checkIMEI(){

result.innerText="Checking...";

const res=await fetch(API+"/check-imei",{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
email:localStorage.email,
imei:imei.value,
service:service.value
})
});

result.innerText=await res.text();
}

// ================= LOGOUT =================
function logout(){
localStorage.clear();
location.reload();
}

// ================= AUTO LOGIN =================
if(localStorage.email){
showDashboard(localStorage.balance);
loadPrice();
}

</script>

</body>
</html>
